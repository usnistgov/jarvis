
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>jarvis.analysis.interface.zur &#8212; jarvis-tools v2021.2.3 documentation</title>
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">jarvis-tools v2021.2.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for jarvis.analysis.interface.zur</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Design interface using Zur algorithm and Anderson rule.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">jarvis.core.atoms</span> <span class="kn">import</span> <span class="n">add_atoms</span><span class="p">,</span> <span class="n">fix_pbc</span>
<span class="kn">from</span> <span class="nn">jarvis.core.lattice</span> <span class="kn">import</span> <span class="n">Lattice</span>


<div class="viewcode-block" id="ZSLGenerator"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.ZSLGenerator">[docs]</a><span class="k">class</span> <span class="nc">ZSLGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses Zur algorithm to find best matched interfaces.</span>

<span class="sd">    This class is modified from pymatgen.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_area_ratio_tol</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
        <span class="n">max_area</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
        <span class="n">max_length_tol</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
        <span class="n">max_angle_tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Intialize for a specific film and substrate.</span>

<span class="sd">        Parameters for the class.</span>
<span class="sd">        Args:</span>
<span class="sd">            max_area_ratio_tol(float): Max tolerance on ratio of</span>
<span class="sd">                super-lattices to consider equal</span>

<span class="sd">            max_area(float): max super lattice area to generate in search</span>

<span class="sd">            max_length_tol: maximum length tolerance in checking if two</span>
<span class="sd">                vectors are of nearly the same length</span>

<span class="sd">            max_angle_tol: maximum angle tolerance in checking of two sets</span>
<span class="sd">                of vectors have nearly the same angle between them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_area_ratio_tol</span> <span class="o">=</span> <span class="n">max_area_ratio_tol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_area</span> <span class="o">=</span> <span class="n">max_area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_length_tol</span> <span class="o">=</span> <span class="n">max_length_tol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_angle_tol</span> <span class="o">=</span> <span class="n">max_angle_tol</span>

<div class="viewcode-block" id="ZSLGenerator.is_same_vectors"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.ZSLGenerator.is_same_vectors">[docs]</a>    <span class="k">def</span> <span class="nf">is_same_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec_set1</span><span class="p">,</span> <span class="n">vec_set2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check two sets of vectors are the same.</span>

<span class="sd">        Args:</span>
<span class="sd">            vec_set1(array[array]): an array of two vectors</span>

<span class="sd">            vec_set2(array[array]): second array of two vectors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">rel_strain</span><span class="p">(</span><span class="n">vec_set1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vec_set2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length_tol</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">rel_strain</span><span class="p">(</span><span class="n">vec_set1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vec_set2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length_tol</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">rel_angle</span><span class="p">(</span><span class="n">vec_set1</span><span class="p">,</span> <span class="n">vec_set2</span><span class="p">))</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_angle_tol</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ZSLGenerator.generate_sl_transformation_sets"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.ZSLGenerator.generate_sl_transformation_sets">[docs]</a>    <span class="k">def</span> <span class="nf">generate_sl_transformation_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">film_area</span><span class="p">,</span> <span class="n">substrate_area</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate transformation sets for film/substrate.</span>

<span class="sd">        The transformation sets map the film and substrate unit cells to super</span>
<span class="sd">        lattices with a maximum area.</span>

<span class="sd">        Args:</span>

<span class="sd">            film_area(int): the unit cell area for the film.</span>

<span class="sd">            substrate_area(int): the unit cell area for the substrate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            transformation_sets: a set of transformation_sets defined as:</span>
<span class="sd">                1.) the transformation matricies for the film to create a</span>
<span class="sd">                super lattice of area i*film area</span>
<span class="sd">                2.) the tranformation matricies for the substrate to create</span>
<span class="sd">                a super lattice of area j*film area</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transformation_indicies</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_area</span> <span class="o">/</span> <span class="n">film_area</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_area</span> <span class="o">/</span> <span class="n">substrate_area</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">film_area</span> <span class="o">/</span> <span class="n">substrate_area</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">i</span><span class="p">)</span>
            <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_area_ratio_tol</span>
        <span class="p">]</span>

        <span class="c1"># Sort sets by the square of the matching area and yield in order</span>
        <span class="c1"># from smallest to largest</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">transformation_indicies</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">yield</span> <span class="p">(</span>
                <span class="n">gen_sl_transform_matricies</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">gen_sl_transform_matricies</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ZSLGenerator.get_equiv_transformations"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.ZSLGenerator.get_equiv_transformations">[docs]</a>    <span class="k">def</span> <span class="nf">get_equiv_transformations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">transformation_sets</span><span class="p">,</span> <span class="n">film_vectors</span><span class="p">,</span> <span class="n">substrate_vectors</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the transformation_sets to the film and substrate vectors.</span>

<span class="sd">        Generate super-lattices and checks if they matches.</span>
<span class="sd">        Returns all matching vectors sets.</span>

<span class="sd">        Args:</span>
<span class="sd">            transformation_sets(array): an array of transformation sets:</span>
<span class="sd">                each transformation set is an array with the (i,j)</span>
<span class="sd">                indicating the area multipes of the film and subtrate it</span>
<span class="sd">                corresponds to, an array with all possible transformations</span>
<span class="sd">                for the film area multiple i and another array for the</span>
<span class="sd">                substrate area multiple j.</span>

<span class="sd">            film_vectors(array): film vectors to generate super lattices.</span>

<span class="sd">            substrate_vectors(array): substrate vectors to generate super</span>
<span class="sd">                lattices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">film_transformations</span><span class="p">,</span>
            <span class="n">substrate_transformations</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">transformation_sets</span><span class="p">:</span>
            <span class="c1"># Apply transformations and reduce using Zur reduce methodology</span>
            <span class="n">films</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">reduce_vectors</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">film_vectors</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">film_transformations</span>
            <span class="p">]</span>

            <span class="n">substrates</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">reduce_vectors</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">substrate_vectors</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">substrate_transformations</span>
            <span class="p">]</span>

            <span class="c1"># Check if equivalant super lattices</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">f_trans</span><span class="p">,</span> <span class="n">s_trans</span><span class="p">),</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">product</span><span class="p">(</span><span class="n">film_transformations</span><span class="p">,</span> <span class="n">substrate_transformations</span><span class="p">),</span>
                <span class="n">product</span><span class="p">(</span><span class="n">films</span><span class="p">,</span> <span class="n">substrates</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_same_vectors</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">f_trans</span><span class="p">,</span> <span class="n">s_trans</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">film_vectors</span><span class="p">,</span> <span class="n">substrate_vectors</span><span class="p">,</span> <span class="n">lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the ZSL algorithm to generate all possible matching.&quot;&quot;&quot;</span>
        <span class="n">film_area</span> <span class="o">=</span> <span class="n">vec_area</span><span class="p">(</span><span class="o">*</span><span class="n">film_vectors</span><span class="p">)</span>
        <span class="n">substrate_area</span> <span class="o">=</span> <span class="n">vec_area</span><span class="p">(</span><span class="o">*</span><span class="n">substrate_vectors</span><span class="p">)</span>

        <span class="c1"># Generate all super lattice comnbinations for a given set of miller</span>
        <span class="c1"># indicies</span>
        <span class="n">transformation_sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_sl_transformation_sets</span><span class="p">(</span>
            <span class="n">film_area</span><span class="p">,</span> <span class="n">substrate_area</span>
        <span class="p">)</span>

        <span class="c1"># Check each super-lattice pair to see if they match</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_equiv_transformations</span><span class="p">(</span>
            <span class="n">transformation_sets</span><span class="p">,</span> <span class="n">film_vectors</span><span class="p">,</span> <span class="n">substrate_vectors</span>
        <span class="p">):</span>
            <span class="c1"># Yield the match area, the miller indicies,</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_as_dict</span><span class="p">(</span>
                <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">film_vectors</span><span class="p">,</span>
                <span class="n">substrate_vectors</span><span class="p">,</span>
                <span class="n">vec_area</span><span class="p">(</span><span class="o">*</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">match</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">lowest</span><span class="p">:</span>
                <span class="k">break</span>

<div class="viewcode-block" id="ZSLGenerator.match_as_dict"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.ZSLGenerator.match_as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">match_as_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">film_sl_vectors</span><span class="p">,</span>
        <span class="n">substrate_sl_vectors</span><span class="p">,</span>
        <span class="n">film_vectors</span><span class="p">,</span>
        <span class="n">substrate_vectors</span><span class="p">,</span>
        <span class="n">match_area</span><span class="p">,</span>
        <span class="n">film_transformation</span><span class="p">,</span>
        <span class="n">substrate_transformation</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return dict which contains ZSL match.</span>

<span class="sd">        Args:</span>
<span class="sd">            film_miller(array)</span>

<span class="sd">            substrate_miller(array)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;film_sl_vecs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">film_sl_vectors</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sub_sl_vecs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">substrate_sl_vectors</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;match_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_area</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;film_vecs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">film_vectors</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;sub_vecs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">substrate_vectors</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;film_transformation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">film_transformation</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;substrate_transformation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">substrate_transformation</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="gen_sl_transform_matricies"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.gen_sl_transform_matricies">[docs]</a><span class="k">def</span> <span class="nf">gen_sl_transform_matricies</span><span class="p">(</span><span class="n">area_multiple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate the transformation matricies.</span>

<span class="sd">    Convert a set of 2D vectors into a super</span>
<span class="sd">    lattice of integer area multiple as proven</span>
<span class="sd">    in Cassels:</span>
<span class="sd">    Cassels, John William Scott. An introduction to the geometry of</span>
<span class="sd">    numbers. Springer Science &amp; Business Media, 2012.</span>

<span class="sd">    Args:</span>
<span class="sd">        area_multiple(int): integer multiple of unit cell area for super</span>
<span class="sd">        lattice area.</span>

<span class="sd">    Returns:</span>
<span class="sd">        matrix_list: transformation matricies to covert unit vectors to</span>
<span class="sd">        super lattice vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">area_multiple</span> <span class="o">/</span> <span class="n">i</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">get_factors</span><span class="p">(</span><span class="n">area_multiple</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">area_multiple</span> <span class="o">//</span> <span class="n">i</span><span class="p">)</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="rel_strain"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.rel_strain">[docs]</a><span class="k">def</span> <span class="nf">rel_strain</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate relative strain between two vectors.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span> <span class="o">/</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="rel_angle"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.rel_angle">[docs]</a><span class="k">def</span> <span class="nf">rel_angle</span><span class="p">(</span><span class="n">vec_set1</span><span class="p">,</span> <span class="n">vec_set2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the relative angle between two vector sets.</span>

<span class="sd">    Args:</span>
<span class="sd">        vec_set1(array[array]): an array of two vectors.</span>

<span class="sd">        vec_set2(array[array]): second array of two vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">vec_angle</span><span class="p">(</span><span class="n">vec_set2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vec_set2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">/</span> <span class="n">vec_angle</span><span class="p">(</span><span class="n">vec_set1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vec_set1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="o">-</span> <span class="mi">1</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="fast_norm"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.fast_norm">[docs]</a><span class="k">def</span> <span class="nf">fast_norm</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Much faster variant of numpy linalg norm.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span></div>


<div class="viewcode-block" id="vec_angle"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.vec_angle">[docs]</a><span class="k">def</span> <span class="nf">vec_angle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate angle between two vectors.&quot;&quot;&quot;</span>
    <span class="n">cosang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">sinang</span> <span class="o">=</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sinang</span><span class="p">,</span> <span class="n">cosang</span><span class="p">)</span></div>


<div class="viewcode-block" id="vec_area"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.vec_area">[docs]</a><span class="k">def</span> <span class="nf">vec_area</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Area of lattice plane defined by two vectors.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span></div>


<div class="viewcode-block" id="reduce_vectors"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.reduce_vectors">[docs]</a><span class="k">def</span> <span class="nf">reduce_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate independent and unique basis vectors based on Zur et al.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">reduce_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reduce_vectors</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">reduce_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fast_norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">reduce_vectors</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_factors"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.get_factors">[docs]</a><span class="k">def</span> <span class="nf">get_factors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate all factors of n.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">x</span></div>


<div class="viewcode-block" id="make_interface"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.make_interface">[docs]</a><span class="k">def</span> <span class="nf">make_interface</span><span class="p">(</span>
    <span class="n">film</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">subs</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">atol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ltol</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">max_area</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">max_area_ratio_tol</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
    <span class="n">seperation</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
    <span class="n">vacuum</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">apply_strain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use as main function for making interfaces/heterostructures.</span>

<span class="sd">    Return mismatch and other information as info dict.</span>

<span class="sd">    Args:</span>
<span class="sd">       film: top/film material.</span>

<span class="sd">       subs: substrate/bottom/fixed material.</span>

<span class="sd">       seperation: minimum seperation between two.</span>

<span class="sd">       vacuum: vacuum will be added on both sides.</span>
<span class="sd">       So 2*vacuum will be added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">ZSLGenerator</span><span class="p">(</span>
        <span class="n">max_area_ratio_tol</span><span class="o">=</span><span class="n">max_area_ratio_tol</span><span class="p">,</span>
        <span class="n">max_area</span><span class="o">=</span><span class="n">max_area</span><span class="p">,</span>
        <span class="n">max_length_tol</span><span class="o">=</span><span class="n">ltol</span><span class="p">,</span>
        <span class="n">max_angle_tol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">film</span> <span class="o">=</span> <span class="n">fix_pbc</span><span class="p">(</span><span class="n">film</span><span class="o">.</span><span class="n">center_around_origin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">subs</span> <span class="o">=</span> <span class="n">fix_pbc</span><span class="p">(</span><span class="n">subs</span><span class="o">.</span><span class="n">center_around_origin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">z</span><span class="p">(</span><span class="n">film</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">subs</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mismatch_u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mismatch_v&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mismatch_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;area1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;area2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;film_sl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;matches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matches</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;subs_sl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">uv1</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;sub_sl_vecs&quot;</span><span class="p">]</span>
    <span class="n">uv2</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;film_sl_vecs&quot;</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uv1</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uv2</span><span class="p">)</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mismatch_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">mismatch_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">angle1</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>
        <span class="o">*</span> <span class="mi">180</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="p">)</span>
    <span class="n">angle2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">b2</span><span class="p">))</span>
        <span class="o">*</span> <span class="mi">180</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="p">)</span>
    <span class="n">mismatch_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle1</span> <span class="o">-</span> <span class="n">angle2</span><span class="p">)</span>
    <span class="n">area1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">))</span>
    <span class="n">area2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">))</span>
    <span class="n">uv_substrate</span> <span class="o">=</span> <span class="n">uv1</span>
    <span class="n">uv_film</span> <span class="o">=</span> <span class="n">uv2</span>
    <span class="n">substrate_latt</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">uv_substrate</span><span class="p">[</span><span class="mi">0</span><span class="p">][:],</span> <span class="n">uv_substrate</span><span class="p">[</span><span class="mi">1</span><span class="p">][:],</span> <span class="n">subs</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]]</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">scell</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span>
        <span class="n">substrate_latt</span><span class="p">,</span> <span class="n">ltol</span><span class="o">=</span><span class="n">ltol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span>
    <span class="p">)</span>
    <span class="n">film_latt</span> <span class="o">=</span> <span class="n">Lattice</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">uv_film</span><span class="p">[</span><span class="mi">0</span><span class="p">][:],</span> <span class="n">uv_film</span><span class="p">[</span><span class="mi">1</span><span class="p">][:],</span> <span class="n">film</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]])</span>
    <span class="p">)</span>
    <span class="n">scell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">scell_subs</span> <span class="o">=</span> <span class="n">scell</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">scell</span> <span class="o">=</span> <span class="n">film</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">find_matches</span><span class="p">(</span><span class="n">film_latt</span><span class="p">,</span> <span class="n">ltol</span><span class="o">=</span><span class="n">ltol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
    <span class="n">scell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">scell_film</span> <span class="o">=</span> <span class="n">scell</span>
    <span class="n">film_scell</span> <span class="o">=</span> <span class="n">film</span><span class="o">.</span><span class="n">make_supercell_matrix</span><span class="p">(</span><span class="n">scell_film</span><span class="p">)</span>
    <span class="n">subs_scell</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">make_supercell_matrix</span><span class="p">(</span><span class="n">scell_subs</span><span class="p">)</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mismatch_u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mismatch_u</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mismatch_v&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mismatch_v</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mismatch_u,mismatch_v&quot;</span><span class="p">,</span> <span class="n">mismatch_u</span><span class="p">,</span> <span class="n">mismatch_v</span><span class="p">)</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;mismatch_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mismatch_angle</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;area1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area1</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;area2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area2</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;film_sl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">film_scell</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;subs_sl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subs_scell</span>
    <span class="n">substrate_top_z</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subs_scell</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">substrate_bot_z</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subs_scell</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">film_top_z</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">film_scell</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">film_bottom_z</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">film_scell</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">thickness_sub</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">substrate_top_z</span> <span class="o">-</span> <span class="n">substrate_bot_z</span><span class="p">)</span>
    <span class="n">thickness_film</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">film_top_z</span> <span class="o">-</span> <span class="n">film_bottom_z</span><span class="p">)</span>
    <span class="n">sub_z</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">vacuum</span> <span class="o">+</span> <span class="n">substrate_top_z</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subs_scell</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">subs_scell</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
    <span class="p">)</span>
    <span class="n">shift_normal</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sub_z</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sub_z</span><span class="p">)</span> <span class="o">*</span> <span class="n">seperation</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sub_z</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">thickness_film</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">seperation</span> <span class="o">+</span> <span class="n">thickness_sub</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">subs_scell</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">shift_normal</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">tmp</span>
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subs_scell</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
        <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">subs_scell</span><span class="o">.</span><span class="n">lattice_mat</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
    <span class="p">)</span>
    <span class="n">interface</span> <span class="o">=</span> <span class="n">add_atoms</span><span class="p">(</span>
        <span class="n">film_scell</span><span class="p">,</span> <span class="n">subs_scell</span><span class="p">,</span> <span class="n">shift_normal</span><span class="p">,</span> <span class="n">apply_strain</span><span class="o">=</span><span class="n">apply_strain</span>
    <span class="p">)</span><span class="o">.</span><span class="n">center_around_origin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">vacuum</span><span class="o">=</span><span class="n">vacuum</span><span class="p">)</span><span class="o">.</span><span class="n">center_around_origin</span><span class="p">(</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;interface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined</span>
    <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="get_hetero_type"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.get_hetero_type">[docs]</a><span class="k">def</span> <span class="nf">get_hetero_type</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="p">{},</span> <span class="n">B</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;Provide heterojunction classification using Anderson rule.&quot;&quot;&quot;</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="n">int_type</span> <span class="o">=</span> <span class="s2">&quot;na&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">A</span><span class="p">[</span><span class="s2">&quot;scf_vbm&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="s2">&quot;avg_max&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">[</span><span class="s2">&quot;scf_vbm&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="s2">&quot;avg_max&quot;</span><span class="p">]:</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="s2">&quot;BA&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">A</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">B</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">D</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">C</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="s2">&quot;AB&quot;</span>
        <span class="n">vbm_a</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="s2">&quot;scf_vbm&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="s2">&quot;avg_max&quot;</span><span class="p">]</span>
        <span class="n">vbm_b</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="s2">&quot;scf_vbm&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="s2">&quot;avg_max&quot;</span><span class="p">]</span>
        <span class="n">cbm_a</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="s2">&quot;scf_cbm&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="s2">&quot;avg_max&quot;</span><span class="p">]</span>
        <span class="n">cbm_b</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="s2">&quot;scf_cbm&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="s2">&quot;avg_max&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">vbm_a</span> <span class="o">&lt;</span> <span class="n">vbm_b</span> <span class="ow">and</span> <span class="n">vbm_b</span> <span class="o">&lt;</span> <span class="n">cbm_b</span> <span class="ow">and</span> <span class="n">cbm_b</span> <span class="o">&lt;</span> <span class="n">cbm_a</span><span class="p">:</span>
            <span class="n">int_type</span> <span class="o">=</span> <span class="s2">&quot;I&quot;</span>
        <span class="k">elif</span> <span class="n">vbm_a</span> <span class="o">&lt;</span> <span class="n">vbm_b</span> <span class="ow">and</span> <span class="n">vbm_b</span> <span class="o">&lt;</span> <span class="n">cbm_a</span> <span class="ow">and</span> <span class="n">cbm_a</span> <span class="o">&lt;</span> <span class="n">cbm_b</span><span class="p">:</span>
            <span class="n">int_type</span> <span class="o">=</span> <span class="s2">&quot;II&quot;</span>
        <span class="k">elif</span> <span class="n">vbm_a</span> <span class="o">&lt;</span> <span class="n">cbm_a</span> <span class="ow">and</span> <span class="n">cbm_a</span> <span class="o">&lt;</span> <span class="n">vbm_b</span> <span class="ow">and</span> <span class="n">vbm_b</span> <span class="o">&lt;</span> <span class="n">cbm_b</span><span class="p">:</span>
            <span class="n">int_type</span> <span class="o">=</span> <span class="s2">&quot;III&quot;</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">int_type</span><span class="p">,</span> <span class="n">stack</span></div>


<div class="viewcode-block" id="mismatch_strts"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.mismatch_strts">[docs]</a><span class="k">def</span> <span class="nf">mismatch_strts</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return mismatch and other information as info dict.</span>

<span class="sd">    Deprecated, preserved here so legacy imports work.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="get_hetero"><a class="viewcode-back" href="../../../../jarvis.analysis.interface.html#jarvis.analysis.interface.zur.get_hetero">[docs]</a><span class="k">def</span> <span class="nf">get_hetero</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Generate heterostructure. Deprecated also.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">if __name__ == &quot;__main__&quot;:</span>
<span class="sd">    s1 = Poscar.from_file(</span>
<span class="sd">        &quot;MAIN-RELAX-Surf-mp-1821/POSCAR&quot;</span>
<span class="sd">    )</span>
<span class="sd">    s2 = Poscar.from_file(</span>
<span class="sd">        &quot;MAIN-RELAX-Surf-mp-2815/POSCAR&quot;</span>
<span class="sd">    )</span>
<span class="sd">    print(s1)</span>
<span class="sd">    print(s2)</span>
<span class="sd">    info = mismatch_strts(film=s1.atoms, subs=s2.atoms)</span>
<span class="sd">    # print (info)</span>
<span class="sd">    print((s1.__dict__[&quot;atoms&quot;].lattice_mat))</span>
<span class="sd">    d = s1.__dict__[&quot;atoms&quot;]</span>
<span class="sd">    f = open(&quot;test.json&quot;, &quot;wb&quot;)</span>
<span class="sd">    joblib.dump(s1, f)</span>
<span class="sd">    f.close()</span>
<span class="sd">    print(get_hetero(s1.atoms, s2.atoms))</span>
<span class="sd">    ff = open(&quot;test.json&quot;, &quot;rb&quot;)</span>
<span class="sd">    dd = joblib.load(ff)</span>
<span class="sd">    ff.close()</span>
<span class="sd">    # print (dd.atoms.lattice_mat)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">jarvis-tools v2021.2.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Kamal Choudhary.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>