
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>jarvis.db.vasp_to_xml &#8212; jarvis-tools v2021.2.3 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">jarvis-tools v2021.2.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for jarvis.db.vasp_to_xml</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module to make XML for JARVIS-REST-API schema.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">jarvis.core.atoms</span> <span class="kn">import</span> <span class="n">Atoms</span>
<span class="kn">from</span> <span class="nn">jarvis.core.atoms</span> <span class="kn">import</span> <span class="n">VacuumPadding</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">jarvis.core.atoms</span> <span class="kn">import</span> <span class="n">get_supercell_dims</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.thermodynamics.energetics</span> <span class="kn">import</span> <span class="n">get_twod_defect_energy</span>
<span class="kn">from</span> <span class="nn">jarvis.io.vasp.outputs</span> <span class="kn">import</span> <span class="n">Oszicar</span><span class="p">,</span> <span class="n">Vasprun</span><span class="p">,</span> <span class="n">Outcar</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">imread</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.structure.spacegroup</span> <span class="kn">import</span> <span class="n">Spacegroup3D</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.topological.spillage</span> <span class="kn">import</span> <span class="n">Spillage</span>
<span class="kn">from</span> <span class="nn">jarvis.db.jsonutils</span> <span class="kn">import</span> <span class="n">loadjson</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.phonon.ir</span> <span class="kn">import</span> <span class="n">ir_intensity</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.structure.neighbors</span> <span class="kn">import</span> <span class="n">NeighborsAnalysis</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.solarefficiency.solar</span> <span class="kn">import</span> <span class="n">SolarEfficiency</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.stm.tersoff_hamann</span> <span class="kn">import</span> <span class="n">TersoffHamannSTM</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.thermodynamics.energetics</span> <span class="kn">import</span> <span class="n">form_enp</span>
<span class="kn">from</span> <span class="nn">jarvis.tasks.boltztrap.run</span> <span class="kn">import</span> <span class="n">run_boltztrap</span>
<span class="kn">from</span> <span class="nn">jarvis.tasks.phonopy.run</span> <span class="kn">import</span> <span class="n">run_phonopy</span>
<span class="kn">from</span> <span class="nn">jarvis.io.phonopy.outputs</span> <span class="kn">import</span> <span class="n">bandstructure_plot</span>
<span class="kn">from</span> <span class="nn">jarvis.ai.pkgs.utils</span> <span class="kn">import</span> <span class="n">get_ml_data</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.diffraction.xrd</span> <span class="kn">import</span> <span class="n">XRD</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">jarvis.analysis.elastic.tensor</span> <span class="kn">import</span> <span class="n">ElasticTensor</span>
<span class="kn">from</span> <span class="nn">jarvis.io.boltztrap.outputs</span> <span class="kn">import</span> <span class="n">BoltzTrapOutput</span>
<span class="kn">from</span> <span class="nn">jarvis.io.vasp.outputs</span> <span class="kn">import</span> <span class="n">parse_raman_dat</span>
<span class="kn">from</span> <span class="nn">jarvis.core.utils</span> <span class="kn">import</span> <span class="n">array_to_string</span>
<span class="kn">from</span> <span class="nn">jarvis.core.utils</span> <span class="kn">import</span> <span class="n">stringdict_to_xml</span>
<span class="kn">from</span> <span class="nn">jarvis.ai.descriptors.cfid</span> <span class="kn">import</span> <span class="n">CFID</span>
<span class="kn">from</span> <span class="nn">jarvis.io.wannier.outputs</span> <span class="kn">import</span> <span class="n">WannierHam</span>
<span class="kn">from</span> <span class="nn">jarvis.db.figshare</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">cfid_x</span><span class="p">,</span> <span class="n">cfid_y</span><span class="p">,</span> <span class="n">cfid_jids</span> <span class="o">=</span> <span class="n">get_ml_data</span><span class="p">()</span>

<span class="n">figshare_dict</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="s2">&quot;raw_files&quot;</span><span class="p">)</span>

<span class="n">wait_time</span> <span class="o">=</span> <span class="mi">20</span>


<div class="viewcode-block" id="get_cfid_descriptors"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.get_cfid_descriptors">[docs]</a><span class="k">def</span> <span class="nf">get_cfid_descriptors</span><span class="p">(</span>
    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;JVASP-1002&quot;</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">make_cfid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">material_type</span><span class="o">=</span><span class="s2">&quot;bulk&quot;</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get CFID pre-computed descriptors for a JID.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cfid_x</span><span class="p">,</span> <span class="n">cfid_jids</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">jid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">if</span> <span class="n">make_cfid</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating CFID descriptors.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">material_type</span> <span class="o">==</span> <span class="s2">&quot;Mol&quot;</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">VacuumPadding</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">vacuum</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span><span class="o">.</span><span class="n">get_effective_molecule</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;Layer&quot;</span> <span class="ow">in</span> <span class="n">material_type</span><span class="p">:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">VacuumPadding</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">vacuum</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span><span class="o">.</span><span class="n">get_effective_2d_slab</span><span class="p">()</span>
        <span class="n">cfid</span> <span class="o">=</span> <span class="n">CFID</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cfid</span><span class="o">.</span><span class="n">get_comp_descp</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_figshare_files"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.get_figshare_files">[docs]</a><span class="k">def</span> <span class="nf">get_figshare_files</span><span class="p">(</span><span class="n">jid</span><span class="o">=</span><span class="s2">&quot;JVASP-1067&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get Figshare download links.&quot;&quot;&quot;</span>
    <span class="n">mem</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">figshare_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">jjid</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">jjid</span> <span class="o">==</span> <span class="n">jid</span><span class="p">:</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="s2">&quot;download_url&quot;</span><span class="p">]</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="s2">&quot;download_url&quot;</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
                    <span class="n">mem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span></div>


<span class="n">icsd_mp_dat</span> <span class="o">=</span> <span class="n">loadjson</span><span class="p">(</span><span class="s2">&quot;/rk2/knc6/JARVIS-DFT/icsd_mp_dat.json&quot;</span><span class="p">)</span>

<span class="c1"># Number of ICSDs</span>
<span class="c1"># x=[]</span>
<span class="c1"># for i in icsd_mp_dat:</span>
<span class="c1">#    mpid=i[&#39;mpid&#39;]</span>
<span class="c1">#    tmp=icsd_mp(mpid)</span>
<span class="c1">#    if tmp!=&#39;&#39;:</span>
<span class="c1">#       print (mpid,tmp)</span>
<span class="c1">#       y=tmp.split(&#39;,&#39;)</span>
<span class="c1">#       for j in y:</span>
<span class="c1">#         x.append(j)</span>
<span class="c1"># print (len(x))</span>


<div class="viewcode-block" id="icsd_mp"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.icsd_mp">[docs]</a><span class="k">def</span> <span class="nf">icsd_mp</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get ICSD IDs given MPIDs.&quot;&quot;&quot;</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">icsd_mp_dat</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;mpid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ref</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;icsds&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;icsds&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">ids</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;icsds&quot;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ids</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;icsds&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
    <span class="k">return</span> <span class="n">ids</span></div>


<div class="viewcode-block" id="get_see_also"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.get_see_also">[docs]</a><span class="k">def</span> <span class="nf">get_see_also</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate see also link.&quot;&quot;&quot;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;mp-&quot;</span> <span class="ow">in</span> <span class="n">tag</span> <span class="ow">or</span> <span class="s2">&quot;mvc-&quot;</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
        <span class="n">mpid</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;MP: https://www.materialsproject.org/materials/&quot;</span> <span class="o">+</span> <span class="n">mpid</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
        <span class="n">icsd</span> <span class="o">=</span> <span class="n">icsd_mp</span><span class="p">(</span><span class="n">mpid</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;ICSD: &quot;</span> <span class="o">+</span> <span class="n">icsd</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
    <span class="k">return</span> <span class="n">line</span></div>


<div class="viewcode-block" id="VaspToApiXmlSchema"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema">[docs]</a><span class="k">class</span> <span class="nc">VaspToApiXmlSchema</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Module to convert VASP data to XML schema for API.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">folder</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">meta_data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;id_file&quot;</span><span class="p">:</span> <span class="s2">&quot;JARVIS-ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tmp_id_file&quot;</span><span class="p">:</span> <span class="s2">&quot;&#39;JARVIS-ID&#39;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ehull&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data_source&quot;</span><span class="p">:</span> <span class="s2">&quot;JARVIS-DFT-VASP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tmp_data_source&quot;</span><span class="p">:</span> <span class="s2">&quot;&#39;JARVIS-DFT-VASP&#39;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;material_type&quot;</span><span class="p">:</span> <span class="s2">&quot;bulk&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tmp_material_type&quot;</span><span class="p">:</span> <span class="s2">&quot;&#39;bulk&#39;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;exfoliation_energy&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize class.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder</span> <span class="o">=</span> <span class="n">folder</span>
        <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;bulk&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;1L&quot;</span> <span class="ow">in</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SingleLayer&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;2L&quot;</span> <span class="ow">in</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;BiLayer&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;3L&quot;</span> <span class="ow">in</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;TriLayer&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Mol-&quot;</span> <span class="ow">in</span> <span class="n">folder</span><span class="p">:</span>
            <span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Molecule&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span> <span class="o">=</span> <span class="n">meta_data</span>

<div class="viewcode-block" id="VaspToApiXmlSchema.ebandstruct"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.ebandstruct">[docs]</a>    <span class="k">def</span> <span class="nf">ebandstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vrun</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kp</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get electronic bandstucre related data.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">vrun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">vrun</span><span class="p">)</span>
            <span class="n">band_indir_gap</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">band_dir_gap</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">band_indir_gap</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">vrun</span><span class="o">.</span><span class="n">get_indir_gap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">band_dir_gap</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">vrun</span><span class="o">.</span><span class="n">get_dir_gap</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get bandgap.&quot;</span><span class="p">,</span> <span class="n">kp</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;band_indir_gap&gt;&quot;</span> <span class="o">+</span> <span class="n">band_indir_gap</span> <span class="o">+</span> <span class="s2">&quot;&lt;/band_indir_gap&gt;&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;band_dir_gap&gt;&quot;</span> <span class="o">+</span> <span class="n">band_dir_gap</span> <span class="o">+</span> <span class="s2">&quot;&lt;/band_dir_gap&gt;&quot;</span>

            <span class="n">fermi_velocities</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fermi_velocities</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">vrun</span><span class="o">.</span><span class="n">fermi_velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get the Fermi-velocity.&quot;</span><span class="p">,</span> <span class="n">kp</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;fermi_velocities&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="n">fermi_velocities</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/fermi_velocities&gt;&#39;</span>
            <span class="p">)</span>

            <span class="n">kp_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kp_labels_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ii</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kp_labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">kp_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                            <span class="n">kp_labels_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="n">kp_labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">kp_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                            <span class="n">kp_labels_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">zero_efermi</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">zero_efermi</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vrun</span><span class="o">.</span><span class="n">efermi</span><span class="p">)</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">up_bands_y</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">up_bands_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vrun</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="n">spin</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ii</span><span class="p">))))</span>
                <span class="n">up_bands_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">up_bands_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">spin</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">down_bands_y</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">down_bands_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vrun</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="n">spin</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">tmp</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ii</span><span class="p">))))</span>
                <span class="n">down_bands_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">down_bands_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;kp_labels_points&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">kp_labels_points</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/kp_labels_points&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;kp_labels&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">kp_labels</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/kp_labels&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;spin_up_bands_x&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">up_bands_x</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/spin_up_bands_x&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;spin_up_bands_y&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">up_bands_y</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/spin_up_bands_y&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;spin_down_bands_x&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">down_bands_x</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/spin_down_bands_x&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;spin_down_bands_y&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">down_bands_y</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/spin_down_bands_y&gt;&#39;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not get bandstructure info,vrun,kp&quot;</span><span class="p">,</span> <span class="n">vrun</span><span class="p">,</span> <span class="n">kp</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.encut_kp"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.encut_kp">[docs]</a>    <span class="k">def</span> <span class="nf">encut_kp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get ENCUT, cut-off convergence data.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">encut_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">encut_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">encut_based_energies</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;ENCUT*.json&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;ENCUT&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">encut_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="n">encut_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">erun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">folder</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;vasprun.xml&quot;</span>
                    <span class="p">)</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Vasprun</span><span class="p">(</span><span class="n">erun</span><span class="p">)</span><span class="o">.</span><span class="n">final_energy</span><span class="p">)</span>
                    <span class="n">encut_based_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>

            <span class="n">kplength_files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kp_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">kp_based_energies</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;KPOINT*.json&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;KPOINT&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">kp_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="n">kplength_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">krun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">folder</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;vasprun.xml&quot;</span>
                    <span class="p">)</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Vasprun</span><span class="p">(</span><span class="n">krun</span><span class="p">)</span><span class="o">.</span><span class="n">final_energy</span><span class="p">)</span>
                    <span class="n">kp_based_energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="n">encut_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">encut_values</span><span class="p">)</span>
            <span class="n">encut_based_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">encut_based_energies</span><span class="p">)</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">encut_values</span><span class="p">)</span>
            <span class="n">encut_values</span> <span class="o">=</span> <span class="n">encut_values</span><span class="p">[</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">encut_based_energies</span> <span class="o">=</span> <span class="n">encut_based_energies</span><span class="p">[</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">kp_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kp_values</span><span class="p">)</span>
            <span class="n">kp_based_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kp_based_energies</span><span class="p">)</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">kp_values</span><span class="p">)</span>
            <span class="n">kp_values</span> <span class="o">=</span> <span class="n">kp_values</span><span class="p">[</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">kp_based_energies</span> <span class="o">=</span> <span class="n">kp_based_energies</span><span class="p">[</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;converged_encut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">encut_values</span><span class="p">)))[</span><span class="o">-</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;converged_kpoint_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kp_values</span><span class="p">)))[</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;kp_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">kp_values</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;kp_based_energies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">kp_based_energies</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;encut_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">encut_values</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;encut_based_energies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">encut_based_energies</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encut_kp_info</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Check the convergence folders are named properly&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.electronic_dos_info"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.electronic_dos_info">[docs]</a>    <span class="k">def</span> <span class="nf">electronic_dos_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vrun</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get electronic dos information with , _ and ; seperators.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">total_dos</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">total_dos</span>
            <span class="c1"># energies = np.array(total_dos[0])</span>
            <span class="n">spdf_dos</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">get_spdf_dos</span><span class="p">()</span>
            <span class="n">atom_dos</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">get_atom_resolved_dos</span><span class="p">()</span>

            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">total_dos</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">line</span>
                        <span class="o">+</span> <span class="s2">&quot;&lt;edos_energies&gt;&#39;&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="o">-</span> <span class="n">vrun</span><span class="o">.</span><span class="n">efermi</span><span class="p">))</span>
                        <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/edos_energies&gt;&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;&lt;total_edos_up&gt;&#39;&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                        <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/total_edos_up&gt;&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;&lt;total_edos_down&gt;&#39;&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                        <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/total_edos_down&gt;&quot;</span>
                    <span class="p">)</span>

            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;spdf_dos&gt;&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">spdf_dos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="s2">&quot;&lt;&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
                    <span class="c1"># + &quot;&gt;&#39;&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                    <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;&lt;/&quot;</span>
                    <span class="c1"># + &quot;&#39;&lt;/&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
                <span class="p">)</span>

            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/spdf_dos&gt;&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;elemental_dos&gt;&quot;</span>
            <span class="n">spin_up_info</span> <span class="o">=</span> <span class="n">atom_dos</span><span class="p">[</span><span class="s2">&quot;spin_up_info&quot;</span><span class="p">]</span>
            <span class="n">spin_down_info</span> <span class="o">=</span> <span class="n">atom_dos</span><span class="p">[</span><span class="s2">&quot;spin_down_info&quot;</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&lt;spin_up_info&gt;&quot;&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">spin_up_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&lt;/spin_up_info&gt;&#39;</span>

            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&lt;spin_down_info&gt;&quot;&#39;</span>
            <span class="c1"># line += &#39;&lt;spin_down_info&gt;&quot;&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">spin_down_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&lt;/spin_down_info&gt;&#39;</span>
            <span class="c1"># line += &#39;&quot;&lt;/spin_down_info&gt;&#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/elemental_dos&gt;&quot;</span>

            <span class="n">fermi_velocities</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fermi_velocities</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">vrun</span><span class="o">.</span><span class="n">fermi_velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get the dos Fermi-velocity.&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;fermi_velocities&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="n">fermi_velocities</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/fermi_velocities&gt;&#39;</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get DOS data&quot;</span><span class="p">,</span> <span class="n">vrun</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.get_xrd"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.get_xrd">[docs]</a>    <span class="k">def</span> <span class="nf">get_xrd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get XRD pattern.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">two_thetas</span><span class="p">,</span> <span class="n">d_hkls</span><span class="p">,</span> <span class="n">intensities</span> <span class="o">=</span> <span class="n">XRD</span><span class="p">()</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">atoms</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;two_thetas&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">two_thetas</span><span class="p">)</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/two_thetas&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&lt;d_hkls&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">d_hkls</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/d_hkls&gt;&#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;intensities&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">intensities</span><span class="p">)</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/intensities&gt;&#39;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot gt XRD pattern.&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.electronic_band_struct"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.electronic_band_struct">[docs]</a>    <span class="k">def</span> <span class="nf">electronic_band_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vasprun</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kpoints_file_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get electronic_band_struct.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ebandstruct</span><span class="p">(</span><span class="n">vrun</span><span class="o">=</span><span class="n">vasprun</span><span class="p">,</span> <span class="n">kp</span><span class="o">=</span><span class="n">kpoints_file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_band"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_band">[docs]</a>    <span class="k">def</span> <span class="nf">main_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get bandstructure from MAIN-BAND-*.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-BAND*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vrun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                <span class="n">kp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/KPOINTS&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_band_struct</span><span class="p">(</span>
                    <span class="n">vasprun</span><span class="o">=</span><span class="n">vrun</span><span class="p">,</span> <span class="n">kpoints_file_path</span><span class="o">=</span><span class="n">kp</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get ebands info&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_bands_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_hse06_band"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_hse06_band">[docs]</a>    <span class="k">def</span> <span class="nf">main_hse06_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get bandstructure from MAIN-HSE-*.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-HSE*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vrun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                <span class="n">kp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/KPOINTS&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_band_struct</span><span class="p">(</span>
                    <span class="n">vasprun</span><span class="o">=</span><span class="n">vrun</span><span class="p">,</span> <span class="n">kpoints_file_path</span><span class="o">=</span><span class="n">kp</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get hseband info&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_hse_bands_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_pbe0_band"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_pbe0_band">[docs]</a>    <span class="k">def</span> <span class="nf">main_pbe0_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get bandstructure from MAIN-PBE0-*.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-PBE0*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vrun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                <span class="n">kp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/KPOINTS&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_band_struct</span><span class="p">(</span>
                    <span class="n">vasprun</span><span class="o">=</span><span class="n">vrun</span><span class="p">,</span> <span class="n">kpoints_file_path</span><span class="o">=</span><span class="n">kp</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get ebands info&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_pbe0_bands_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.get_wannier_lines"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.get_wannier_lines">[docs]</a>    <span class="k">def</span> <span class="nf">get_wannier_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">energy_tol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">write_full_data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get data for wannier- quality check.&quot;&quot;&quot;</span>
        <span class="c1"># Dense mesh</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">mesh_vrun_x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mesh_vrun_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;maxdiff_mesh&gt;&#39;&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infomesh&quot;</span><span class="p">][</span><span class="s2">&quot;maxdiff&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/maxdiff_mesh&gt;&quot;</span>
        <span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;maxdiff_bz&gt;&#39;&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infobz&quot;</span><span class="p">][</span><span class="s2">&quot;maxdiff&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/maxdiff_bz&gt;&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">write_full_data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infomesh&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_vrun&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ii</span><span class="p">))))</span>
                <span class="n">mesh_vrun_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">mesh_vrun_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;mesh_vrun_x&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">mesh_vrun_x</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/mesh_vrun_x&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;mesh_vrun_y&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">mesh_vrun_y</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/mesh_vrun_y&gt;&#39;</span>
            <span class="p">)</span>

            <span class="n">min_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">erange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">energy_tol</span><span class="p">,</span> <span class="n">energy_tol</span><span class="p">]</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">kpp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;infomesh&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_vrun&quot;</span><span class="p">]</span>
            <span class="n">vasp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infomesh&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_vrun&quot;</span><span class="p">])</span>
            <span class="n">wann</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infomesh&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_wan&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kpp</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">wann</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">diff_arr</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">erange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">erange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vasp</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>
                            <span class="n">diff_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">diff_arr</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">diff_arr</span><span class="p">)</span>
                        <span class="n">dd</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
                        <span class="n">min_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;mesh_difference_values&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/mesh_difference_values&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;mesh_difference_keys&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/mesh_difference_keys&gt;&#39;</span>
            <span class="p">)</span>

            <span class="n">mesh_wann_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mesh_wann_y</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infomesh&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_wan&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ii</span><span class="p">))))</span>
                <span class="n">mesh_wann_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">mesh_wann_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;mesh_wann_x&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">mesh_wann_x</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/mesh_wann_x&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;mesh_wann_y&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">mesh_wann_y</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/mesh_wann_y&gt;&#39;</span>
            <span class="p">)</span>

            <span class="c1"># High symmetry BZ k-points</span>

            <span class="n">bz_vrun_x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">bz_vrun_y</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infobz&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_vrun&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ii</span><span class="p">))))</span>
                <span class="n">bz_vrun_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">bz_vrun_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;bz_vrun_x&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">bz_vrun_x</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/bz_vrun_x&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;bz_vrun_y&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">bz_vrun_y</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/bz_vrun_y&gt;&#39;</span>
            <span class="p">)</span>

            <span class="n">min_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">erange</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">energy_tol</span><span class="p">,</span> <span class="n">energy_tol</span><span class="p">]</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">kpp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;infobz&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_vrun&quot;</span><span class="p">]</span>
            <span class="n">vasp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infobz&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_vrun&quot;</span><span class="p">])</span>
            <span class="n">wann</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;infobz&quot;</span><span class="p">][</span><span class="s2">&quot;eigs_wan&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kpp</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">wann</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">diff_arr</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">erange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">erange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vasp</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span>
                            <span class="n">diff_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">diff_arr</span> <span class="o">!=</span> <span class="p">[]:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">diff_arr</span><span class="p">)</span>
                        <span class="n">dd</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
                        <span class="n">min_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;bz_difference_values&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="n">values</span><span class="p">())))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/bz_difference_values&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;bz_difference_keys&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/bz_difference_keys&gt;&#39;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.wannier_comparison_plot"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.wannier_comparison_plot">[docs]</a>    <span class="k">def</span> <span class="nf">wannier_comparison_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_tol</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare Wannier and DFT data on mesh and BZ.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Change to WANN</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-WANN*&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">wann_dat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/wannier90_hr.dat&quot;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wann_dat</span><span class="p">):</span>
                    <span class="n">wann_json</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="s2">&quot;/wannier_comparison.json&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking wann&quot;</span><span class="p">,</span> <span class="n">wann_json</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wann_json</span><span class="p">):</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">loadjson</span><span class="p">(</span><span class="n">wann_json</span><span class="p">)</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wannier_lines</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">energy_tol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;Getting data from preexisiting wannier json.&quot;</span><span class="p">,</span>
                            <span class="n">line</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running jarvis-wannier solver.&quot;</span><span class="p">)</span>
                        <span class="n">wann_ham</span> <span class="o">=</span> <span class="n">WannierHam</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">wann_dat</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-*.json&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="s2">&quot;SOCSCFBAND&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                                <span class="n">bands_vrun</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                                    <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
                                    <span class="o">+</span> <span class="n">j</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                                <span class="p">)</span>
                            <span class="k">if</span> <span class="s2">&quot;SOC&quot;</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">and</span> <span class="s2">&quot;BAND&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                                <span class="n">mesh_vrun</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                                    <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
                                    <span class="o">+</span> <span class="n">j</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                                <span class="p">)</span>

                        <span class="n">bz</span> <span class="o">=</span> <span class="n">wann_ham</span><span class="o">.</span><span class="n">compare_dft_wann</span><span class="p">(</span>
                            <span class="n">vasprun_path</span><span class="o">=</span><span class="n">bands_vrun</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
                        <span class="n">mesh</span> <span class="o">=</span> <span class="n">wann_ham</span><span class="o">.</span><span class="n">compare_dft_wann</span><span class="p">(</span>
                            <span class="n">vasprun_path</span><span class="o">=</span><span class="n">mesh_vrun</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;infobz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bz</span>
                        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;infomesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wannier_lines</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">energy_tol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get wannier data.&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tmpw1&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;wannier_band_comparison&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.vacancy_formation_optb88vdw"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.vacancy_formation_optb88vdw">[docs]</a>    <span class="k">def</span> <span class="nf">vacancy_formation_optb88vdw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get vacancy formation energy data.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">vac_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;MAIN-VACANCY&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">vac_path</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">vac_path</span> <span class="o">+</span> <span class="s2">&quot;/JVASP*&quot;</span><span class="p">):</span>
                    <span class="n">vac_vrun_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;MAIN-VACANCY&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span>
                    <span class="p">)</span>
                    <span class="n">outcar</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;MAIN-VACANCY&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;OUTCAR&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">outcar</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                        <span class="n">vac_vrun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">vac_vrun_path</span><span class="p">)</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                        <span class="n">jid</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">atom</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">Ef</span> <span class="o">=</span> <span class="n">get_twod_defect_energy</span><span class="p">(</span>
                            <span class="n">vrun</span><span class="o">=</span><span class="n">vac_vrun</span><span class="p">,</span> <span class="n">jid</span><span class="o">=</span><span class="n">jid</span><span class="p">,</span> <span class="n">atom</span><span class="o">=</span><span class="n">atom</span>
                        <span class="p">)</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="n">jid</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">atom</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">Ef</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                        <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get vacancy info.&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;vacancy_formation_energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.loptics_optoelectronics"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.loptics_optoelectronics">[docs]</a>    <span class="k">def</span> <span class="nf">loptics_optoelectronics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vrun</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get optoelctronic data.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">lvrun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">vrun</span><span class="p">)</span>
            <span class="n">reals</span><span class="p">,</span> <span class="n">imags</span> <span class="o">=</span> <span class="n">lvrun</span><span class="o">.</span><span class="n">dielectric_loptics</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="n">reals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;energies&gt;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">energies</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/energies&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&lt;loptics_dielectric_constant&gt;&quot;&#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reals</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reals</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reals</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reals</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&lt;/loptics_dielectric_constant&gt;&#39;</span>
            <span class="n">lopt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">max_linopt_eps</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">reals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">reals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">reals</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">reals</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">reals</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">reals</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">lopt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">max_linopt_eps</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;max_linopt_eps&gt;&quot;</span> <span class="o">+</span> <span class="n">lopt</span> <span class="o">+</span> <span class="s2">&quot;&lt;/max_linopt_eps&gt;&quot;</span>
            <span class="n">fermi_velocities</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fermi_velocities</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lvrun</span><span class="o">.</span><span class="n">fermi_velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get the lepsilon Fermi-velocity.&quot;</span><span class="p">,</span> <span class="n">vrun</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;fermi_velocities&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="n">fermi_velocities</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/fermi_velocities&gt;&#39;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">reals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="s2">&quot;&lt;real_&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&gt;&#39;&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">reals</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span>
                    <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/real_&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
                <span class="p">)</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="s2">&quot;&lt;imag_&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&gt;&#39;&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">imags</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span>
                    <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/imag_&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get loptics data&quot;</span><span class="p">,</span> <span class="n">vrun</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">eff_slme</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">eff_sq</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">dirgap</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">indirgap</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dirgap</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lvrun</span><span class="o">.</span><span class="n">get_dir_gap</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">indirgap</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lvrun</span><span class="o">.</span><span class="n">get_indir_gap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">en</span><span class="p">,</span> <span class="n">abz</span> <span class="o">=</span> <span class="n">lvrun</span><span class="o">.</span><span class="n">avg_absorption_coefficient</span>
            <span class="n">abz</span> <span class="o">=</span> <span class="n">abz</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">eff_slme</span> <span class="o">=</span> <span class="n">SolarEfficiency</span><span class="p">()</span><span class="o">.</span><span class="n">slme</span><span class="p">(</span>
                <span class="n">en</span><span class="p">,</span> <span class="n">abz</span><span class="p">,</span> <span class="n">indirgap</span><span class="p">,</span> <span class="n">indirgap</span><span class="p">,</span> <span class="n">plot_current_voltage</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="c1"># print(&quot;SLME&quot;, 100 * eff)</span>
            <span class="n">eff_sq</span> <span class="o">=</span> <span class="n">SolarEfficiency</span><span class="p">()</span><span class="o">.</span><span class="n">calculate_SQ</span><span class="p">(</span><span class="n">indirgap</span><span class="p">)</span>
            <span class="n">eff_slme</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">eff_slme</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">eff_sq</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">eff_sq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get solar data.&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;solar_slme&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">eff_slme</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/solar_slme&gt;&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;solar_sq&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">eff_sq</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/solar_sq&gt;&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;opto_dir_gap&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dirgap</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/opto_dir_gap&gt;&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;opto_indir_gap&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">indirgap</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/opto_indir_gap&gt;&quot;</span>

        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_optics_semilocal"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_optics_semilocal">[docs]</a>    <span class="k">def</span> <span class="nf">main_optics_semilocal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get optoelctronic data from MAIN-OPTICS*.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-OPTICS*.json&quot;</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vrun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loptics_optoelectronics</span><span class="p">(</span><span class="n">vrun</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get semilocal optics data&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_optics_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_optics_semilocal_info</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_optics_mbj"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_optics_mbj">[docs]</a>    <span class="k">def</span> <span class="nf">main_optics_mbj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get optoelctronic data from MAIN-MBJ*.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-MBJ*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vrun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loptics_optoelectronics</span><span class="p">(</span><span class="n">vrun</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get mbj optics data&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_optics_mbj_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_optics_mbj_info</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.spillage"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.spillage">[docs]</a>    <span class="k">def</span> <span class="nf">spillage</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">soc_wf</span><span class="o">=</span><span class="s2">&quot;MAIN-SOCSCFBAND-bulk@JVASP-1067_mp-541837/WAVECAR&quot;</span><span class="p">,</span>
        <span class="n">nonsoc_wf</span><span class="o">=</span><span class="s2">&quot;MAIN-MAGSCFBAND-bulk@JVASP-1067_mp-541837/WAVECAR&quot;</span><span class="p">,</span>
        <span class="n">spl_json_existing</span><span class="o">=</span><span class="s2">&quot;/rk2/knc6/DB/SPILLAGE/all_spillage.json&quot;</span><span class="p">,</span>
        <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get spillage data.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            print(&quot;soc_wf&quot;, soc_wf)</span>
<span class="sd">            tmp_jid = jid</span>
<span class="sd">            print(&quot;tmp_jid&quot;, tmp_jid)</span>
<span class="sd">            if tmp_jid != &quot;&quot;:</span>
<span class="sd">                spl_dat = loadjson(spl_json_existing)</span>
<span class="sd">                for i in spl_dat:</span>
<span class="sd">                    if i[&quot;jid&quot;] == tmp_jid:</span>
<span class="sd">                        sp = i</span>
<span class="sd">                        sp[&quot;kpoints&quot;] = list(</span>
<span class="sd">                            [[0, 0, 0] for i in range(len(sp[&quot;spillage_k&quot;]))]</span>
<span class="sd">                        )</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">sp</span> <span class="o">==</span> <span class="p">{}:</span>
                <span class="c1"># As spillage calculation may take a long time</span>
                <span class="c1"># print(&quot;XYZ1&quot;)</span>
                <span class="n">sp</span> <span class="o">=</span> <span class="n">Spillage</span><span class="p">(</span>
                    <span class="n">wf_noso</span><span class="o">=</span><span class="n">nonsoc_wf</span><span class="p">,</span> <span class="n">wf_so</span><span class="o">=</span><span class="n">soc_wf</span>
                <span class="p">)</span><span class="o">.</span><span class="n">overlap_so_spinpol</span><span class="p">()</span>
                <span class="c1"># print(&quot;XYZ2&quot;)</span>
            <span class="n">soc_bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_band_struct</span><span class="p">(</span>
                <span class="n">vasprun</span><span class="o">=</span><span class="n">soc_wf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;WAVECAR&quot;</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
                <span class="n">kpoints_file_path</span><span class="o">=</span><span class="p">(</span><span class="n">soc_wf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;WAVECAR&quot;</span><span class="p">,</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;soc_bands&gt;&quot;</span> <span class="o">+</span> <span class="n">soc_bands</span> <span class="o">+</span> <span class="s2">&quot;&lt;/soc_bands&gt;&quot;</span>
            <span class="n">nonsoc_bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_band_struct</span><span class="p">(</span>
                <span class="n">vasprun</span><span class="o">=</span><span class="n">nonsoc_wf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;WAVECAR&quot;</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">),</span>
                <span class="n">kpoints_file_path</span><span class="o">=</span><span class="p">(</span><span class="n">nonsoc_wf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;WAVECAR&quot;</span><span class="p">,</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">)),</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;nonsoc_bands&gt;&quot;</span> <span class="o">+</span> <span class="n">nonsoc_bands</span> <span class="o">+</span> <span class="s2">&quot;&lt;/nonsoc_bands&gt;&quot;</span>
            <span class="n">spillage_k</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sp</span><span class="p">[</span><span class="s2">&quot;spillage_k&quot;</span><span class="p">]))</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;spillage_k&gt;&#39;&quot;</span> <span class="o">+</span> <span class="n">spillage_k</span> <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/spillage_k&gt;&quot;</span>
            <span class="n">spillage_kpoints</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sp</span><span class="p">[</span><span class="s2">&quot;kpoints&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;spillage_kpoints&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="n">spillage_kpoints</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/spillage_kpoints&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">max_spillage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sp</span><span class="p">[</span><span class="s2">&quot;spillage_k&quot;</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;max_spillage&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_spillage</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/max_spillage&gt;&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get spillage info&quot;</span><span class="p">,</span> <span class="n">soc_wf</span><span class="p">,</span> <span class="n">nonsoc_wf</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_soc_spillage"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_soc_spillage">[docs]</a>    <span class="k">def</span> <span class="nf">main_soc_spillage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get spillage data from folder.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-SOCSCFBAND*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">soc_wf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/WAVECAR&quot;</span>
                <span class="n">nonsoc_wf</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                    <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
                    <span class="o">+</span> <span class="n">folder</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;SOC&quot;</span><span class="p">,</span> <span class="s2">&quot;MAG&quot;</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;/WAVECAR&quot;</span>
                <span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spillage</span><span class="p">(</span>
                    <span class="n">soc_wf</span><span class="o">=</span><span class="n">soc_wf</span><span class="p">,</span> <span class="n">nonsoc_wf</span><span class="o">=</span><span class="n">nonsoc_wf</span><span class="p">,</span> <span class="n">jid</span><span class="o">=</span><span class="n">jid</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get spillage info&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_spillage_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_soc_spillage_info</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.basic_info"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.basic_info">[docs]</a>    <span class="k">def</span> <span class="nf">basic_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include_dos_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">include_neighbor_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_cfid_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get data from MAIN-RELAX folder.&quot;&quot;&quot;</span>
        <span class="n">main_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">main_folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;source_folder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;see_also&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">see_also_dat</span> <span class="o">=</span> <span class="n">get_see_also</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">))</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;see_also&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">see_also_dat</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get seel also data&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;tmp_source_folder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
        <span class="n">id_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;id_file&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-RELAX*.json&quot;</span><span class="p">):</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">main_vrun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
            <span class="n">main_contcar</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/CONTCAR&quot;</span>
            <span class="n">main_outcar</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/OUTCAR&quot;</span>
            <span class="c1"># vrun = Vasprun(main_vrun)</span>
            <span class="c1"># atoms = vrun.all_structures[-1]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">vrun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">main_vrun</span><span class="p">)</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="o">.</span><span class="n">from_poscar</span><span class="p">(</span><span class="n">main_contcar</span><span class="p">)</span>
                <span class="c1"># atoms = vrun.all_structures[-1]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;XRD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xrd</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
                <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="n">id_file</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;download_files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">files_line</span> <span class="o">=</span> <span class="n">get_figshare_files</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;download_files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">files_line</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get figshare files.&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;tmp_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="n">formula</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">reduced_formula</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;formula&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;tmp_formula&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">formula</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">uniq_species</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;elements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;tmp_elements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">elements</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;number_uniq_species&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">uniq_species</span><span class="p">)</span>
                <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;FUNCTIONAL&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cannot find &quot;FUNCTIONAL&quot;&#39;</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PBEBO&quot;</span><span class="p">:</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;OptB88vdW&quot;</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PBEOR&quot;</span><span class="p">:</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;OptPBEvdW&quot;</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PBEMK&quot;</span><span class="p">:</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;OptB86bvdW&quot;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;tmp_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">method</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="n">final_energy</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">final_energy</span>
                <span class="n">num_atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">num_atoms</span>
                <span class="n">fen</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OptB88vdW&quot;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">fen</span> <span class="o">=</span> <span class="n">form_enp</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">atoms</span><span class="p">,</span> <span class="n">total_energy</span><span class="o">=</span><span class="n">final_energy</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get formation energy.&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
                        <span class="k">pass</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;formation_energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fen</span>
                <span class="n">rel_en</span> <span class="o">=</span> <span class="n">final_energy</span> <span class="o">/</span> <span class="n">num_atoms</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;relaxed_energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">rel_en</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">spg</span> <span class="o">=</span> <span class="n">Spacegroup3D</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
                <span class="n">prim_atoms</span> <span class="o">=</span> <span class="n">spg</span><span class="o">.</span><span class="n">primitive_atoms</span>
                <span class="n">conv_atoms</span> <span class="o">=</span> <span class="n">spg</span><span class="o">.</span><span class="n">conventional_standard_structure</span>
                <span class="n">spg_numb</span> <span class="o">=</span> <span class="n">spg</span><span class="o">.</span><span class="n">space_group_number</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;spacegroup_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spg_numb</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;point_group_symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spg</span><span class="o">.</span><span class="n">point_group_symbol</span>
                <span class="c1"># spg_symb = spg.space_group_symbol</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;spg_space_group_symbol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spg</span><span class="o">.</span><span class="n">space_group_symbol</span>
                <span class="n">crys_system</span> <span class="o">=</span> <span class="n">spg</span><span class="o">.</span><span class="n">crystal_system</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;crys_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crys_system</span>
                <span class="n">conv_params</span> <span class="o">=</span> <span class="n">conv_atoms</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span>
                <span class="n">a_conv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">conv_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">b_conv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">conv_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">c_conv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">conv_params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;a_conv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_conv</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;b_conv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_conv</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;c_conv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_conv</span>
                <span class="n">alpha_conv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">conv_params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">beta_conv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">conv_params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">gamma_conv</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">conv_params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;alpha_conv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_conv</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;beta_conv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_conv</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;gamma_conv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_conv</span>
                <span class="n">prim_params</span> <span class="o">=</span> <span class="n">prim_atoms</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span>
                <span class="n">a_prim</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prim_params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">b_prim</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prim_params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">c_prim</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prim_params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;a_prim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_prim</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;b_prim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b_prim</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;c_prim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_prim</span>
                <span class="n">alpha_prim</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prim_params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">beta_prim</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prim_params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">gamma_prim</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">prim_params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;alpha_prim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_prim</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;beta_prim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_prim</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;gamma_prim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma_prim</span>
                <span class="n">prim_natoms</span> <span class="o">=</span> <span class="n">prim_atoms</span><span class="o">.</span><span class="n">num_atoms</span>
                <span class="n">conv_natoms</span> <span class="o">=</span> <span class="n">conv_atoms</span><span class="o">.</span><span class="n">num_atoms</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;prim_natoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prim_natoms</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;conv_natoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_natoms</span>
                <span class="n">density</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">density</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">volume</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">density</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;magnetization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;total_charge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tmp_out</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">(</span><span class="n">main_outcar</span><span class="p">)</span>
                    <span class="n">elms</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">elements</span>
                    <span class="n">magt</span> <span class="o">=</span> <span class="n">tmp_out</span><span class="o">.</span><span class="n">magnetization</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elms</span><span class="p">)</span>
                    <span class="n">totc</span> <span class="o">=</span> <span class="n">tmp_out</span><span class="o">.</span><span class="n">total_charge</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elms</span><span class="p">)</span>

                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;magnetization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">magt</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                    <span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;total_charge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">totc</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;magnetization, chg&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume</span>
                <span class="n">packing_fr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">packing_fr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">packing_fraction</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot calculate packing_fr, check atomic_radii&quot;</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;packing_fr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packing_fr</span>

                <span class="n">dim</span> <span class="o">=</span> <span class="n">get_supercell_dims</span><span class="p">(</span><span class="n">conv_atoms</span><span class="p">)</span>
                <span class="c1"># dim=[1,1,1]</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">conv_atoms</span><span class="o">.</span><span class="n">make_supercell_matrix</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">center_around_origin</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">get_xyz_string</span>
                <span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;xyz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;poscar_conv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;&quot;&#39;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                        <span class="n">conv_atoms</span><span class="o">.</span><span class="n">make_supercell_matrix</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">get_string</span><span class="p">()</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="p">)</span>

                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;contcar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">get_string</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cif_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;atoms.cif&quot;</span><span class="p">)</span>
                    <span class="n">atoms</span><span class="o">.</span><span class="n">write_cif</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;atoms.cif&quot;</span><span class="p">)</span>
                    <span class="n">cif_f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cif_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                    <span class="n">cif_lines</span> <span class="o">=</span> <span class="n">cif_f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c1"># .splitlines()</span>
                    <span class="n">cif_f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cif_filename</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cif&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cif_lines</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CIF exception&quot;</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
                    <span class="k">pass</span>

                <span class="c1"># info[&quot;xyz&quot;] = &#39;&quot;&#39; + str(xyz).replace(&quot;\n&quot;, &quot;\\n&quot;) + &#39;&quot;&#39;</span>
                <span class="n">rdf_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">10.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
                <span class="n">ang1_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">181.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ang2_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">181.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dhd_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">181.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">rdf_hist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ang1_hist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ang2_hist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">dhd_hist</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cfid_descs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="c1"># Use pre-computed CFID dataset with chemo-structural features</span>
                <span class="k">if</span> <span class="n">use_cfid_data</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">cfid_descs</span> <span class="o">=</span> <span class="n">get_cfid_descriptors</span><span class="p">(</span>
                            <span class="n">jid</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                            <span class="n">atoms</span><span class="o">=</span><span class="n">atoms</span><span class="p">,</span>
                            <span class="n">material_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">cfid_descs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">include_neighbor_info</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">rdf_hist</span> <span class="o">=</span> <span class="n">cfid_descs</span><span class="p">[</span><span class="mi">820</span><span class="p">:</span><span class="mi">920</span><span class="p">]</span>
                            <span class="n">ang1_hist</span> <span class="o">=</span> <span class="n">cfid_descs</span><span class="p">[</span><span class="mi">920</span><span class="p">:</span><span class="mi">1099</span><span class="p">]</span>
                            <span class="n">ang2_hist</span> <span class="o">=</span> <span class="n">cfid_descs</span><span class="p">[</span><span class="mi">1099</span><span class="p">:</span><span class="mi">1278</span><span class="p">]</span>
                            <span class="n">dhd_hist</span> <span class="o">=</span> <span class="n">cfid_descs</span><span class="p">[</span><span class="mi">1278</span><span class="p">:</span><span class="mi">1457</span><span class="p">]</span>
                            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cfid_descs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">cfid_descs</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                            <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exp</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot obtain cfid dataset&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="n">include_neighbor_info</span><span class="p">:</span>
                    <span class="n">nbr</span> <span class="o">=</span> <span class="n">NeighborsAnalysis</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
                    <span class="n">rdf_bins</span><span class="p">,</span> <span class="n">rdf_hist</span><span class="p">,</span> <span class="n">nn</span> <span class="o">=</span> <span class="n">nbr</span><span class="o">.</span><span class="n">get_rdf</span><span class="p">()</span>
                    <span class="n">nbr</span> <span class="o">=</span> <span class="n">NeighborsAnalysis</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
                    <span class="n">ang1_hist</span><span class="p">,</span> <span class="n">ang1_bins</span> <span class="o">=</span> <span class="n">nbr</span><span class="o">.</span><span class="n">ang_dist_first</span><span class="p">()</span>
                    <span class="n">ang2_hist</span><span class="p">,</span> <span class="n">ang2_bins</span> <span class="o">=</span> <span class="n">nbr</span><span class="o">.</span><span class="n">ang_dist_second</span><span class="p">()</span>
                    <span class="n">dhd_hist</span><span class="p">,</span> <span class="n">dhd_bins</span> <span class="o">=</span> <span class="n">nbr</span><span class="o">.</span><span class="n">get_ddf</span><span class="p">()</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;rdf_bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">rdf_bins</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;rdf_hist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">rdf_hist</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>

                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ang1_bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ang1_bins</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ang1_hist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ang1_hist</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ang2_bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ang2_bins</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ang2_hist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ang2_hist</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;dihedral_bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">dhd_bins</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;dihedral_hist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">dhd_hist</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                <span class="p">)</span>

                <span class="n">scf_indir_gap</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">get_indir_gap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">scf_dir_gap</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">get_dir_gap</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;scf_indir_gap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">scf_indir_gap</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;scf_dir_gap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">scf_dir_gap</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">oszicar</span> <span class="o">=</span> <span class="n">Oszicar</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;OSZICAR&quot;</span><span class="p">))</span>
                    <span class="n">magmom</span> <span class="o">=</span> <span class="n">oszicar</span><span class="o">.</span><span class="n">magnetic_moment</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;magmom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">magmom</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Check oszicar&quot;</span><span class="p">)</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="n">include_dos_info</span><span class="p">:</span>
                    <span class="n">main_relax_dos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_dos_info</span><span class="p">(</span><span class="n">vrun</span><span class="p">)</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_relax_dos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">main_relax_dos</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">expt</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exception in basic info&quot;</span><span class="p">,</span> <span class="n">expt</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">main_folder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_info_dict</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.dfpt_related"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.dfpt_related">[docs]</a>    <span class="k">def</span> <span class="nf">dfpt_related</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vrun</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get DFPT data.&quot;&quot;&quot;</span>
        <span class="n">vrun</span> <span class="o">=</span> <span class="n">Vasprun</span><span class="p">(</span><span class="n">vrun</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">dfpt_data</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;epsilon&gt;&#39;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;epsilon&quot;</span><span class="p">][</span><span class="s2">&quot;epsilon&quot;</span><span class="p">][:,</span> <span class="n">i</span><span class="p">]))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/epsilon&gt;&quot;</span>
        <span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;epsilon_rpa&gt;&#39;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;epsilon&quot;</span><span class="p">][</span><span class="s2">&quot;epsilon_rpa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/epsilon_rpa&gt;&quot;</span>
        <span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;epsilon_ion&gt;&#39;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;epsilon&quot;</span><span class="p">][</span><span class="s2">&quot;epsilon_ion&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/epsilon_ion&gt;&quot;</span>
        <span class="p">)</span>
        <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;epsilon&quot;</span><span class="p">][</span><span class="s2">&quot;epsilon&quot;</span><span class="p">])))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;max_eps&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_eps</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/max_eps&gt;&quot;</span>
        <span class="n">born_charges</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;born_charges&quot;</span><span class="p">]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">vrun</span><span class="o">.</span><span class="n">all_structures</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">spgg</span> <span class="o">=</span> <span class="n">Spacegroup3D</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">wycs</span> <span class="o">=</span> <span class="n">spgg</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;wyckoffs&quot;</span><span class="p">]</span>
        <span class="c1"># spg = str(spgg._dataset[&quot;number&quot;])</span>
        <span class="n">natoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">num_atoms</span>
        <span class="n">combs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;born_effective_charge&gt;&#39;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
            <span class="n">comb</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wycs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">comb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">combs</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wycs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">born_charges</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
                    <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
                <span class="p">)</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="n">p</span>
                <span class="n">combs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&#39;&lt;/born_effective_charge&gt;&quot;</span>
        <span class="c1"># print (line)</span>
        <span class="c1"># vrun_eigs = data[&quot;phonon_eigenvalues&quot;]</span>
        <span class="n">pza</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">piezoelectric_tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">max_pza</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">pza</span><span class="p">))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;max_piezo_stress_coeff&gt;&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_pza</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/max_piezo_stress_coeff&gt;&quot;</span>
        <span class="p">)</span>
        <span class="n">pz</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pza</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)])</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s1">&#39;&lt;dfpt_piezoelectric_tensor&gt;&quot;&#39;</span>
            <span class="o">+</span> <span class="n">pz</span>
            <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/dfpt_piezoelectric_tensor&gt;&#39;</span>
        <span class="p">)</span>

        <span class="n">phonon_eigenvalues</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">phonon_eigenvalues</span>
        <span class="n">phonon_eigenvectors</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;phonon_eigenvectors&quot;</span><span class="p">]</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;masses&quot;</span><span class="p">]</span>
        <span class="n">born_charges</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;born_charges&quot;</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ir_intensity</span><span class="p">(</span>
            <span class="n">phonon_eigenvectors</span><span class="o">=</span><span class="n">phonon_eigenvectors</span><span class="p">,</span>
            <span class="n">phonon_eigenvalues</span><span class="o">=</span><span class="n">phonon_eigenvalues</span><span class="p">,</span>
            <span class="n">masses</span><span class="o">=</span><span class="n">masses</span><span class="p">,</span>
            <span class="n">born_charges</span><span class="o">=</span><span class="n">born_charges</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;ir_intensity&gt;&#39;&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&#39;&lt;/ir_intensity&gt;&quot;</span>

        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">ir_intensity</span><span class="p">(</span>
            <span class="n">smoothen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">phonon_eigenvectors</span><span class="o">=</span><span class="n">phonon_eigenvectors</span><span class="p">,</span>
            <span class="n">phonon_eigenvalues</span><span class="o">=</span><span class="n">phonon_eigenvalues</span><span class="p">,</span>
            <span class="n">masses</span><span class="o">=</span><span class="n">masses</span><span class="p">,</span>
            <span class="n">born_charges</span><span class="o">=</span><span class="n">born_charges</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
        <span class="n">max_ir_mode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">min_ir_mode</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-5</span>
            <span class="n">non_zero_modes</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">&gt;</span> <span class="n">tol</span>
            <span class="n">max_ir_mode</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="n">non_zero_modes</span><span class="p">])</span>
            <span class="n">min_ir_mode</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="n">non_zero_modes</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot find max min IR mode.&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;max_ir_mode&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">max_ir_mode</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&lt;/max_ir_mode&gt;&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;min_ir_mode&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">min_ir_mode</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&lt;/min_ir_mode&gt;&quot;</span>

        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_lepsilon"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_lepsilon">[docs]</a>    <span class="k">def</span> <span class="nf">main_lepsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get DFPT data from folder.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-LEPSILON*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vrun</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/vasprun.xml&quot;</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/OUTCAR&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfpt_related</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">vrun</span><span class="o">=</span><span class="n">vrun</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot find LEPSION data&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_lepsilon_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_lepsilon_info</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.elastic_props"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.elastic_props">[docs]</a>    <span class="k">def</span> <span class="nf">elastic_props</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">outcar</span><span class="o">=</span><span class="s2">&quot;MAIN-ELASTIC-bulk@mp-149/OUTCAR&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get elastic property data.&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">(</span><span class="n">outcar</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out_phonon_eigenvalues</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">phonon_eigenvalues</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get Outcar phonons.&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">vacuum</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">unit_system</span> <span class="o">=</span> <span class="s2">&quot;GPa&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Layer&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">]:</span>
            <span class="n">vacuum</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="o">.</span><span class="n">from_poscar</span><span class="p">(</span><span class="n">outcar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OUTCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">))</span>
            <span class="n">unit_system</span> <span class="o">=</span> <span class="s2">&quot;Nm^-1&quot;</span>
        <span class="n">cij</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">elastic_props</span><span class="p">(</span><span class="n">atoms</span><span class="o">=</span><span class="n">atoms</span><span class="p">,</span> <span class="n">vacuum</span><span class="o">=</span><span class="n">vacuum</span><span class="p">)[</span><span class="s2">&quot;cij&quot;</span><span class="p">])</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">ElasticTensor</span><span class="p">(</span><span class="n">cij</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;Layer&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data</span><span class="p">[</span><span class="s2">&quot;material_type&quot;</span><span class="p">]:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s1">&#39;&lt;cij&gt;&quot;&#39;</span>
            <span class="o">+</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">cij</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)])</span>
            <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/cij&gt;&#39;</span>
        <span class="p">)</span>
        <span class="c1"># print(&quot;line&quot;, line)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;raw_et_tensor&quot;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&lt;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
                <span class="p">)</span>
        <span class="n">totdos</span> <span class="o">=</span> <span class="n">outcar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OUTCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;total_dos.dat&quot;</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&lt;unit_system&gt;&quot;&#39;</span> <span class="o">+</span> <span class="n">unit_system</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/unit_system&gt;&#39;</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">totdos</span><span class="p">):</span>
            <span class="n">run_phonopy</span><span class="p">(</span><span class="n">outcar</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/OUTCAR&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">totdos</span><span class="p">):</span>

            <span class="n">mesh_yaml</span> <span class="o">=</span> <span class="n">outcar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OUTCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;mesh.yaml&quot;</span><span class="p">)</span>
            <span class="n">band_yaml</span> <span class="o">=</span> <span class="n">outcar</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OUTCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;band.yaml&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mesh_yaml</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">nmodes</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;phonon&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;band&quot;</span><span class="p">]</span>
            <span class="n">ph_modes</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nmodes</span><span class="p">:</span>
                <span class="n">ph_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">])</span>
            <span class="n">ph_modes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ph_modes</span><span class="p">))</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">totdos</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pdos</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                    <span class="c1">#   print (lines)</span>
                    <span class="c1"># else:</span>
                    <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">pdos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;phonon_modes&gt;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ph_modes</span><span class="p">]))</span>
                <span class="o">+</span> <span class="s2">&quot;&lt;/phonon_modes&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;min_fd_phonon_mode&gt;&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">out_phonon_eigenvalues</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&lt;/min_fd_phonon_mode&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;&lt;outcar_phonons&gt;&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">out_phonon_eigenvalues</span><span class="p">)</span>
            <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/outcar_phonons&gt;&#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;phonon_dos_frequencies&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">freq</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/phonon_dos_frequencies&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;phonon_dos_intensity&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pdos</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/phonon_dos_intensity&gt;&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Comment until 4 MB text size error</span>
            <span class="n">frequencies</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">label_points</span> <span class="o">=</span> <span class="n">bandstructure_plot</span><span class="p">(</span>
                <span class="n">band_yaml</span>
            <span class="p">)</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)[:,</span> <span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;phonon_bandstructure_distances&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">distances</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/phonon_bandstructure_distances&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;phonon_bandstructure_frequencies&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="n">tmp</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/phonon_bandstructure_frequencies&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;phonon_bandstructure_labels&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/phonon_bandstructure_labels&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;phonon_bandstructure_label_points&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">label_points</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/phonon_bandstructure_label_points&gt;&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_elastic"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_elastic">[docs]</a>    <span class="k">def</span> <span class="nf">main_elastic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get elastic property data from folder.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-ELAST*.json&quot;</span><span class="p">):</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/OUTCAR&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elastic_props</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get ELAST folder&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;main_elastic_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_elastic_info</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.raman_data"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.raman_data">[docs]</a>    <span class="k">def</span> <span class="nf">raman_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get Raman intensity.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;RAMANDIR*/vasp_raman.dat&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">raman_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">ram</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">raman_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">ram</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="n">ram</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">an</span> <span class="o">=</span> <span class="n">raman_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;vasp_raman.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">Atoms</span><span class="o">.</span><span class="n">from_poscar</span><span class="p">(</span><span class="n">an</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">pos</span><span class="o">.</span><span class="n">num_atoms</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">parse_raman_dat</span><span class="p">(</span><span class="n">raman_file</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;&lt;frequencies&gt;&quot;&#39;</span>
                        <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;freqs&quot;</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/frequencies&gt;&#39;</span>
                    <span class="p">)</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;&lt;activity&gt;&quot;&#39;</span>
                        <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;activity&quot;</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/activity&gt;&#39;</span>
                    <span class="p">)</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;&lt;alpha&gt;&quot;&#39;</span>
                        <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/alpha&gt;&#39;</span>
                    <span class="p">)</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;&lt;beta2&gt;&quot;&#39;</span>
                        <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;beta2&quot;</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/beta2&gt;&#39;</span>
                    <span class="p">)</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s1">&#39;&lt;indices&gt;&quot;&#39;</span>
                        <span class="o">+</span> <span class="n">array_to_string</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;beta2&quot;</span><span class="p">])</span>
                        <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/indices&gt;&#39;</span>
                    <span class="p">)</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="s2">&quot;&lt;max_raman_mode&gt;&quot;</span>
                        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;freqs&quot;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
                        <span class="o">+</span> <span class="s2">&quot;&lt;/max_raman_mode&gt;&quot;</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot process Raman data.&quot;</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;raman_dat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.effective_mass_data"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.effective_mass_data">[docs]</a>    <span class="k">def</span> <span class="nf">effective_mass_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;Get effective-mass data.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">trap</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s2">&quot;trap_info.json&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">loadjson</span><span class="p">(</span><span class="n">trap</span><span class="p">)</span>
            <span class="n">avg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;avg_mass&quot;</span><span class="p">]</span>
            <span class="n">ndat</span> <span class="o">=</span> <span class="n">avg</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">][</span><span class="s2">&quot;300&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="n">pdat</span> <span class="o">=</span> <span class="n">avg</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="s2">&quot;300&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;electron_mass_300K&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ndat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ndat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ndat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/electron_mass_300K&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s1">&#39;&lt;hole_mass_300K&gt;&quot;&#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">pdat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">pdat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">pdat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s1">&#39;&quot;&lt;/hole_mass_300K&gt;&#39;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;max_electron_mass_300K&gt;&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ndat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ndat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ndat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&lt;/max_electron_mass_300K&gt;&quot;</span>
            <span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;max_hole_mass_300K&gt;&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">pdat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdat</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pdat</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&lt;/max_hole_mass_300K&gt;&quot;</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get trap info.&quot;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;effective_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.boltztrap_data"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.boltztrap_data">[docs]</a>    <span class="k">def</span> <span class="nf">boltztrap_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;MAIN-RELAX-bulk@mp-149/boltztrap&quot;</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">doping</span><span class="o">=</span><span class="mf">1e20</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get transport data.&quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cwd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">run_boltztrap</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/boltztrap&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">BoltzTrapOutput</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="c1"># info[&quot;all_data&quot;] = all_data</span>
        <span class="n">small_p</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;condtens_fixdoping&quot;</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">][</span><span class="n">temperature</span><span class="p">]</span>
        <span class="n">small_n</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="s2">&quot;condtens_fixdoping&quot;</span><span class="p">][</span><span class="s2">&quot;n&quot;</span><span class="p">][</span><span class="n">temperature</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">small_p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="s2">&quot;N_cm3&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">doping</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">pseeb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span>
                            <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;seeb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">pcond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;cond&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                        <span class="o">/</span> <span class="mf">1e14</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">ppf</span> <span class="o">=</span> <span class="n">pseeb</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pcond</span> <span class="o">/</span> <span class="mf">1e6</span>
                <span class="n">pkappa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;kappa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;pseeb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pseeb</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;pcond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pcond</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ppf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ppf</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;pkappa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pkappa</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">small_n</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="s2">&quot;N_cm3&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">doping</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">nseeb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span>
                            <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;seeb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">ncond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;cond&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                        <span class="o">/</span> <span class="mf">1e14</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">npf</span> <span class="o">=</span> <span class="n">nseeb</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ncond</span> <span class="o">/</span> <span class="mf">1e6</span>
                <span class="n">nkappa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;kappa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;nseeb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">nseeb</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                <span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;ncond&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ncond</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                <span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;npf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">npf</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;nkappa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nkappa</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="s2">&quot;;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">j</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;&lt;&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;&gt;&#39;&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
            <span class="p">)</span>
        <span class="c1"># print (line)</span>
        <span class="c1"># print (all_data)</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_boltz_data"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_boltz_data">[docs]</a>    <span class="k">def</span> <span class="nf">main_boltz_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get transport data from folder.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-RELAX*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/boltztrap&quot;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boltztrap_data</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot find boltztrap folder&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;boltztrap_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boltztrap_info_dict</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.image_to_string"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.image_to_string">[docs]</a>    <span class="k">def</span> <span class="nf">image_to_string</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">img_path</span><span class="o">=</span><span class="s2">&quot;2DSTM/PNG_JSON3/JVASP-60776_mp-19795_pos.jpg&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transform image to string.&quot;&quot;&quot;</span>
        <span class="c1"># 2D array only</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">fig</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
        <span class="p">)</span>
        <span class="c1"># Comment when 4 MBlimit is over</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_stm_neg"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_stm_neg">[docs]</a>    <span class="k">def</span> <span class="nf">main_stm_neg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get neg. bias constant height STM image.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-STM-NEG*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">pchg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/PARCHG&quot;</span>
                <span class="n">TH_STM</span> <span class="o">=</span> <span class="n">TersoffHamannSTM</span><span class="p">(</span><span class="n">chg_name</span><span class="o">=</span><span class="n">pchg</span><span class="p">)</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/testh.jpg&quot;</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">TH_STM</span><span class="o">.</span><span class="n">constant_height</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">zcut</span> <span class="o">=</span> <span class="n">t1</span><span class="p">[</span><span class="s2">&quot;zcut&quot;</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">zcut</span><span class="p">)</span>
                <span class="c1"># line += &quot;&lt;zcut&gt;&quot; + str(zcut) + &quot;&lt;/zcut&gt;&quot;</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img_path</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;rm -rf &quot;</span> <span class="o">+</span> <span class="n">filename</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Couldnt make negative bias STM image&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.main_stm_pos"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.main_stm_pos">[docs]</a>    <span class="k">def</span> <span class="nf">main_stm_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get pos. bias constant height STM image.&quot;&quot;&quot;</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-STM-POS*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">pchg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/PARCHG&quot;</span>
                <span class="n">TH_STM</span> <span class="o">=</span> <span class="n">TersoffHamannSTM</span><span class="p">(</span><span class="n">chg_name</span><span class="o">=</span><span class="n">pchg</span><span class="p">)</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/testh.jpg&quot;</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">TH_STM</span><span class="o">.</span><span class="n">constant_height</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">zcut</span> <span class="o">=</span> <span class="n">t1</span><span class="p">[</span><span class="s2">&quot;zcut&quot;</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">zcut</span><span class="p">)</span>
                <span class="c1"># line += &quot;&lt;zcut&gt;&quot; + str(zcut) + &quot;&lt;/zcut&gt;&quot;</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img_path</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;rm -rf &quot;</span> <span class="o">+</span> <span class="n">filename</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Couldnt make positive bias STM image&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.efg_tensor"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.efg_tensor">[docs]</a>    <span class="k">def</span> <span class="nf">efg_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get electric field gradient tensor.&quot;&quot;&quot;</span>
        <span class="n">main_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">efg_dat</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">max_efg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">main_folder</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;MAIN-LEFG*.json&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/OUTCAR&quot;</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="n">Atoms</span><span class="o">.</span><span class="n">from_poscar</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OUTCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">))</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
                <span class="n">spgg</span> <span class="o">=</span> <span class="n">Spacegroup3D</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
                <span class="n">wycs</span> <span class="o">=</span> <span class="n">spgg</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;wyckoffs&quot;</span><span class="p">]</span>
                <span class="n">natoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">num_atoms</span>
                <span class="n">combs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">efg</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">efg_raw_tensor</span>
                <span class="n">efg_dat</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">max_efg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">efg</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
                    <span class="n">comb</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">wycs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">comb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">combs</span><span class="p">:</span>
                        <span class="n">efg_dat</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">efg_dat</span>
                            <span class="o">+</span> <span class="n">comb</span>
                            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                            <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">efg</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
                            <span class="o">+</span> <span class="s2">&quot;;&quot;</span>
                        <span class="p">)</span>
                        <span class="n">combs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot get LEFG folder&quot;</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
                <span class="k">pass</span>

        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;efg_raw_tensor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">efg_dat</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;max_efg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_efg</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;max_efg_eta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># self.efg_raw_tensor_info = info</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">main_folder</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="VaspToApiXmlSchema.write_xml"><a class="viewcode-back" href="../../../jarvis.db.html#jarvis.db.vasp_to_xml.VaspToApiXmlSchema.write_xml">[docs]</a>    <span class="k">def</span> <span class="nf">write_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;temp.xml&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get overall XML file.&quot;&quot;&quot;</span>
        <span class="c1"># f=open(filename,&quot;w&quot;)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;&lt;?xml-stylesheet type=&quot;text/xsl&quot; &#39;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s1">&#39;href=&quot;jarvisdft.xsl&quot;?&gt;</span><span class="se">\n</span><span class="s1">&lt;basic_info&gt;&#39;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;convergence_info&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encut_kp</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/convergence_info&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">tmpw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wannier_comparison_plot</span><span class="p">()</span>
        <span class="c1"># print (&#39;tmpw=&#39;,tmpw,stringdict_to_xml(tmpw))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="n">tmpw</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vacancy_formation_optb88vdw</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raman_data</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">b_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_info</span><span class="p">()</span>
        <span class="n">jid</span> <span class="o">=</span> <span class="n">b_info</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_relax_info&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="n">b_info</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_relax_info&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_band&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_band</span><span class="p">(),</span> <span class="n">enforce_string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_band&gt;&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_hse06_band&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_hse06_band</span><span class="p">(),</span> <span class="n">enforce_string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_hse06_band&gt;&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>

        <span class="n">line</span> <span class="o">+=</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">effective_mass_data</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># f.write(str(line))</span>

        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_pbe0_band&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_pbe0_band</span><span class="p">(),</span> <span class="n">enforce_string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_pbe0_band&gt;&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_optics_semilocal&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_optics_semilocal</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_optics_semilocal&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_optics_mbj&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_optics_mbj</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_optics_mbj&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_elastic&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_elastic</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_elastic&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;&lt;main_boltz&gt;&quot;</span>
            <span class="o">+</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_boltz_data</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;&lt;/main_boltz&gt;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_lepsilon</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_soc_spillage</span><span class="p">(</span><span class="n">jid</span><span class="o">=</span><span class="n">jid</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">stringdict_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efg_tensor</span><span class="p">(),</span> <span class="n">enforce_string</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">stm_neg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">stm_pos</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">stm_pos_file</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;/u/WWW/knc6/static/JARVIS-DFT-STM/Images/JARVIS-2D-STM-JPG/&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;_pos.jpg&quot;</span>
        <span class="p">)</span>
        <span class="n">stm_neg_file</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;/u/WWW/knc6/static/JARVIS-DFT-STM/Images/JARVIS-2D-STM-JPG/&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;_neg.jpg&quot;</span>
        <span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;https://www.ctcms.nist.gov/&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;~knc6/static/JARVIS-DFT-STM/Images/JARVIS-2D-STM-JPG/&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stm_pos_file</span><span class="p">):</span>
            <span class="n">stm_pos</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_pos.jpg&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;main_stm_pos&gt;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stm_pos</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/main_stm_pos&gt;&quot;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stm_neg_file</span><span class="p">):</span>
            <span class="n">stm_neg</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_neg.jpg&quot;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;main_stm_neg&gt;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stm_neg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&lt;/main_stm_neg&gt;&quot;</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;&lt;/basic_info&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># print (line)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="c1"># f.write(&quot;&lt;/basic_info&gt;\n&quot;)</span>
        <span class="c1"># f.close()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
        <span class="c1"># line = (</span>
        <span class="c1">#    &quot;&lt;main_stm_neg&gt;&quot; + str(self.main_stm_neg()) + &quot;&lt;/main_stm_neg&gt;&quot;</span>
        <span class="c1"># )</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="c1"># line = (</span>
        <span class="c1">#    &quot;&lt;main_stm_pos&gt;&quot; + str(self.main_stm_pos()) + &quot;&lt;/main_stm_pos&gt;&quot;</span>
        <span class="c1"># )</span>
        <span class="c1"># f.write(str(line))</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            line = &quot;&lt;stm_image&gt;&quot; + image_to_string() + &quot;&lt;/stm_image&gt;&quot;+ &quot;\n&quot;</span>
<span class="sd">            f.write(str(line))</span>
<span class="sd">            line =&#39;&lt;/basic_info&gt;&#39;</span>
<span class="sd">            f.write(str(line))</span>
<span class="sd">            &quot;&quot;&quot;</span></div></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">folder = &quot;/rk2/knc6/JARVIS-DFT/Met-Rar/mp-10891_PBEBO&quot;</span>
<span class="sd">filename = &quot;/cluster/users/knc6/justback/MTI/JVASP-16366.xml&quot;</span>
<span class="sd">VaspToApiXmlSchema(folder=folder).write_xml(filename=filename)</span>

<span class="sd">folder = &quot;/rk2/knc6/JARVIS-DFT/2D-1L/POSCAR-mp-2815-1L.vasp_PBEBO&quot;</span>
<span class="sd">filename = &quot;JVASP-664.xml&quot;</span>
<span class="sd">VaspToApiXmlSchema(folder=folder).write_xml(filename=filename)</span>


<span class="sd">folder = &quot;/rk2/knc6/JARVIS-DFT/Elements-bulkk/mp-149_bulk_PBEBO&quot;</span>
<span class="sd">filename = &quot;JVASP-1002.xml&quot;</span>
<span class="sd">VaspToApiXmlSchema(folder=folder).write_xml(filename=filename)</span>


<span class="sd">if __name__ == &quot;__main__&quot;:</span>
<span class="sd">    folder = &quot;/rk2/knc6/JARVIS-DFT/TE-bulk/mp-541837_bulk_PBEBO&quot;</span>
<span class="sd">    filename = &quot;JVASP-1067.xml&quot;</span>
<span class="sd">    VaspToApiXmlSchema(folder=folder).write_xml(filename=filename)</span>

<span class="sd">    folder = &quot;/rk2/knc6/JARVIS-DFT/2DSF-bulk/mp-764365_PBEBO&quot;</span>
<span class="sd">    filename = &quot;JVASP-30266.xml&quot;</span>
<span class="sd">    VaspToApiXmlSchema(folder=folder).write_xml(filename=filename)</span>

<span class="sd">    folder = &quot;/rk2/knc6/JARVIS-DFT/Elements-bulkk/mp-149_bulk_PBEBO&quot;</span>
<span class="sd">    filename = &quot;JVASP-1002.xml&quot;</span>
<span class="sd">    VaspToApiXmlSchema(folder=folder).write_xml(filename=filename)</span>

<span class="sd">    folder = &quot;/rk2/knc6/JARVIS-DFT/2D-1L/POSCAR-mp-2815-1L.vasp_PBEBO&quot;</span>
<span class="sd">    filename = &quot;JVASP-664.xml&quot;</span>
<span class="sd">    VaspToApiXmlSchema(folder=folder).write_xml(filename=filename)</span>

<span class="sd">    # directories = [&quot;/rk2/knc6/JARVIS-DFT/Elements-bulkk/mp-149_bulk_PBEBO&quot;]</span>
<span class="sd">    # filenames = [&quot;JVASP-1002.xml&quot;]</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">jarvis-tools v2021.2.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Kamal Choudhary.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>